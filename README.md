# PokerAA Deck Shuffling Algorithm

## Introduction:
This proposal outlines the deck shuffling algorithm used by PokerAA for each hand, and explains why it is fully random and cannot be manipulated by server. The algorithm uses a `private seed`, and the `Mersenne Twister 19937` engine with the `sha256` algorithm to generate a truly random deck.

## The algorithm
1. The deck shuffling algorithm starts with the generation of a `private seed`, which is a random string generated by server. The `private seed` is used for all hands of the game, and can be revealed by the owner after the game has ended.

2. At the beginning of each hand, the server calculates the random `nonce` of that hand using a simple string concatenation of the `private seed`, `hand ID`, and the `previous pot`. The previous pot is the total amount of chips committed to the pot at then end the previous hand, and is set to zero for the first hand. The resulting string is as follows: `HandNonce = PrivateSeed + HandId + PreviousPot`

3. The server then calculates the random seed by using the [sha256](https://en.wikipedia.org/wiki/SHA-2) algorithm on the `HandNonce` generated in step 2.

4. The random seed is then used to seed the [Mersenne Twister 19937](https://en.wikipedia.org/wiki/Mersenne_twister) engine using the [random-js](https://www.npmjs.com/package/random-js) library. The deck is shuffled using the [shuffle method](https://www.npmjs.com/package/random-js#distributions) of the random-js as follows:

```typescript
const nonce = game.seed + hand.id + game.lastPot
const seed = sha256(nonce);
const randomizer = MersenneTwister19937.seedWithArray(seed.words)
this.cards = [...BASE_CARDS]
this.cards = shuffle(randomizer, this.cards)
```

## Why this is completely random
1. The random seed is an `sha256`, which means it is impossible to be directly controlled. Any attempts to control the seed would require trial and error, which makes it extremely difficult to manipulate the deck.

2. The source of randomness is completely uncontrollable from the server. The `private seed` is pre-generated, and the server has no knowledge of the upcoming pots. `Hand ID` is deterministic, and the `previous pot` is controlled by user actions, making it impossible for the server to manipulate the deck.

3. The `private seed` can be revealed after the game has ended, which means that anyone can verify the deck of each hand by performing the same algorithm.

4. The `private seed` must be generated at the beginning of the game, as it is not possible to find a suitable seed that will produce the same deck for a played hand. This is because it requires reversing the `sha256` algorithm.

5. The use of the `Mersenne Twister 19937` engine with `sha256` covers all 52! possibilities of shuffling a deck, making it truly random.

## Conclusion
The PokerAA deck shuffling algorithm is a highly secure and reliable method for generating random decks for each hand. Its use of a `private seed`, hand nonce, and the `Mersenne Twister 19937` engine with `sha256` ensures that the deck cannot be manipulated or controlled by server.